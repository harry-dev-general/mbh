<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Manly Boat Hire - Vessel Locations Map</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #f0f4f8;
            color: #333;
            line-height: 1.6;
        }
        
        .header {
            background: linear-gradient(135deg, #1B4F72 0%, #2E86AB 100%);
            color: white;
            padding: 1.5rem;
            text-align: center;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .header h1 {
            font-size: 2rem;
            margin-bottom: 0.5rem;
        }
        
        .container {
            display: flex;
            height: calc(100vh - 100px);
            position: relative;
        }
        
        .sidebar {
            width: 350px;
            background: white;
            box-shadow: 2px 0 10px rgba(0,0,0,0.1);
            overflow-y: auto;
            z-index: 10;
        }
        
        .map-container {
            flex: 1;
            position: relative;
        }
        
        #map {
            width: 100%;
            height: 100%;
        }
        
        .location-card {
            padding: 1.5rem;
            border-bottom: 1px solid #E5E7E9;
            cursor: pointer;
            transition: background 0.3s;
        }
        
        .location-card:hover {
            background: #F8F9F9;
        }
        
        .location-card.active {
            background: #EBF5FB;
            border-left: 4px solid #3498DB;
        }
        
        .location-card h3 {
            color: #2E86AB;
            margin-bottom: 0.5rem;
            display: flex;
            align-items: center;
        }
        
        .location-card h3 i {
            margin-right: 0.5rem;
        }
        
        .vessel-info {
            background: #F8F9F9;
            padding: 0.5rem;
            border-radius: 5px;
            margin: 0.5rem 0;
        }
        
        .vessel-info strong {
            color: #2874A6;
        }
        
        .access-details {
            font-size: 0.9rem;
            color: #666;
            margin-top: 0.5rem;
        }
        
        .access-details li {
            margin: 0.25rem 0;
            padding-left: 1rem;
        }
        
        .legend {
            position: absolute;
            bottom: 20px;
            left: 20px;
            background: white;
            padding: 1rem;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            z-index: 5;
        }
        
        .legend h4 {
            color: #2E86AB;
            margin-bottom: 0.5rem;
        }
        
        .legend-item {
            display: flex;
            align-items: center;
            margin: 0.5rem 0;
        }
        
        .legend-icon {
            width: 30px;
            height: 30px;
            margin-right: 0.5rem;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            color: white;
            font-weight: bold;
        }
        
        .swing-mooring {
            background: #3498DB;
        }
        
        .marina-berth {
            background: #27AE60;
        }
        
        .temp-mooring {
            background: #F39C12;
        }
        
        .directions-btn {
            background: #2E86AB;
            color: white;
            border: none;
            padding: 0.5rem 1rem;
            border-radius: 5px;
            cursor: pointer;
            margin-top: 0.5rem;
            width: 100%;
            transition: background 0.3s;
        }
        
        .directions-btn:hover {
            background: #1B4F72;
        }
        
        .back-btn {
            position: absolute;
            top: 20px;
            left: 370px;
            background: white;
            padding: 0.5rem 1rem;
            border-radius: 5px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            text-decoration: none;
            color: #2E86AB;
            z-index: 10;
            transition: all 0.3s;
        }
        
        .back-btn:hover {
            background: #2E86AB;
            color: white;
        }
        
        .api-key-notice {
            background: #FCF3CF;
            border: 2px solid #F39C12;
            padding: 1rem;
            margin: 1rem;
            border-radius: 5px;
            text-align: center;
        }
        
        .api-key-notice h3 {
            color: #D68910;
            margin-bottom: 0.5rem;
        }
        
        .api-key-notice code {
            background: #FEF9E7;
            padding: 0.2rem 0.5rem;
            border-radius: 3px;
        }
        
        @media (max-width: 768px) {
            .container {
                flex-direction: column;
            }
            
            .sidebar {
                width: 100%;
                height: 40vh;
                order: 2;
            }
            
            .map-container {
                height: 60vh;
                order: 1;
            }
            
            .back-btn {
                left: 20px;
            }
            
            .legend {
                bottom: auto;
                top: 70px;
                left: 10px;
                font-size: 0.8rem;
            }
        }
        
        /* Custom map info window styles */
        .info-window {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 300px;
        }
        
        .info-window h3 {
            color: #2E86AB;
            margin-bottom: 0.5rem;
        }
        
        .info-window .vessel-name {
            background: #EBF5FB;
            padding: 0.3rem 0.5rem;
            border-radius: 3px;
            margin: 0.3rem 0;
            font-weight: bold;
        }
        
        .info-window .detail {
            margin: 0.2rem 0;
            font-size: 0.9rem;
        }
        
        /* View toggle styles */
        .view-toggle {
            position: absolute;
            top: 10px;
            left: 50%;
            transform: translateX(-50%);
            background: white;
            padding: 0.5rem;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            z-index: 10;
            display: flex;
            gap: 0.5rem;
        }
        
        .toggle-btn {
            padding: 0.5rem 1rem;
            border: none;
            background: #E5E7E9;
            color: #333;
            border-radius: 5px;
            cursor: pointer;
            transition: all 0.3s;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        .toggle-btn.active {
            background: #2E86AB;
            color: white;
        }
        
        .toggle-btn:hover:not(.active) {
            background: #D5D8DC;
        }
        
        .anchorage-legend {
            display: none;
        }
        
        .anchorage-legend.active {
            display: block;
        }
        
        .vessel-legend {
            display: block;
        }
        
        .vessel-legend.hidden {
            display: none;
        }
        
        @media (max-width: 768px) {
            .view-toggle {
                top: 60px;
                font-size: 0.9rem;
            }
            
            .toggle-btn {
                padding: 0.4rem 0.8rem;
            }
        }
    </style>
</head>
<body>
    <div class="header">
        <h1><i class="fas fa-map-marked-alt"></i> Vessel Locations & Safe Anchorages</h1>
        <p>Interactive map showing vessel storage locations and safe anchorage areas</p>
    </div>
    
    <a href="dashboard.html" class="back-btn">
        <i class="fas fa-arrow-left"></i> Back to Dashboard
    </a>
    
    <div class="container">
        <div class="sidebar">
            <!-- Little Manly -->
            <div class="location-card" onclick="focusLocation('littleManly')">
                <h3><i class="fas fa-anchor"></i> Little Manly Point Reserve</h3>
                <div class="vessel-info">
                    <strong>Vessel:</strong> JUNIOR (12 seater)<br>
                    <strong>Mooring:</strong> CL8335 (Red Buoy)<br>
                    <strong>Type:</strong> Swing Mooring
                </div>
                <div class="access-details">
                    <strong>Access Details:</strong>
                    <ul>
                        <li>üöó Parking: Stuart Street</li>
                        <li>üõ∂ Tender: Paddle board in racks facing water</li>
                        <li>üìç Near boat ramp</li>
                    </ul>
                </div>
                <button class="directions-btn" onclick="getDirections(-33.807998, 151.286544)">
                    <i class="fas fa-route"></i> Get Directions
                </button>
            </div>
            
            <!-- Balmoral -->
            <div class="location-card" onclick="focusLocation('balmoral')">
                <h3><i class="fas fa-anchor"></i> Balmoral Beach</h3>
                <div class="vessel-info">
                    <strong>Vessel:</strong> SANDSTONE (8 seater)<br>
                    <strong>Type:</strong> Swing Mooring (Temporary)
                </div>
                <div class="access-details">
                    <strong>Access Details:</strong>
                    <ul>
                        <li>üöó Parking: The Esplanade</li>
                        <li>‚ö†Ô∏è Temporary location</li>
                        <li>üìç Check current status</li>
                    </ul>
                </div>
                <button class="directions-btn" onclick="getDirections(-33.826154, 151.254493)">
                    <i class="fas fa-route"></i> Get Directions
                </button>
            </div>
            
            <!-- Seaforth -->
            <div class="location-card" onclick="focusLocation('seaforth')">
                <h3><i class="fas fa-anchor"></i> Seaforth</h3>
                <div class="vessel-info">
                    <strong>Vessel:</strong> PUMICESTONE (12 seater)<br>
                    <strong>Mooring:</strong> CA017/CA023<br>
                    <strong>Type:</strong> Swing Mooring
                </div>
                <div class="access-details">
                    <strong>Access Details:</strong>
                    <ul>
                        <li>üöó Parking: The Spit West Reserve</li>
                        <li>üö§ Tender: Work Boat near Plonk Cafe</li>
                        <li>üìç Navigate through Spit Bridge underpass</li>
                        <li>‚ö†Ô∏è Follow channel alongside Seaforth Crescent</li>
                    </ul>
                </div>
                <button class="directions-btn" onclick="getDirections(-33.804468, 151.239951)">
                    <i class="fas fa-route"></i> Get Directions to The Spit
                </button>
            </div>
            
            <!-- d'Albora Marina -->
            <div class="location-card" onclick="focusLocation('dalbora')">
                <h3><i class="fas fa-building"></i> d'Albora Marina - The Spit</h3>
                <div class="vessel-info">
                    <strong>Vessel:</strong> Ice Cream Boat<br>
                    <strong>Berth:</strong> AE25 (Eastern side of A arm)<br>
                    <strong>Type:</strong> Marina Berth
                </div>
                <div class="access-details">
                    <strong>Access Details:</strong>
                    <ul>
                        <li>üöó Parking: Marina visitor parking (next to Boat Yard)</li>
                        <li>üîë FOB key access (5PM - 7:30AM)</li>
                        <li>‚ö° Check shore power for ice cream freezer</li>
                        <li>üìç Near Dry Dock</li>
                    </ul>
                </div>
                <button class="directions-btn" onclick="getDirections(-33.804802, 151.245358)">
                    <i class="fas fa-route"></i> Get Directions
                </button>
            </div>
            
            <!-- Fergusons Marina -->
            <div class="location-card" onclick="focusLocation('fergusons')">
                <h3><i class="fas fa-building"></i> Fergusons Marina</h3>
                <div class="vessel-info">
                    <strong>Vessel:</strong> Work Boat<br>
                    <strong>Address:</strong> 83 Parriwi Rd, Mosman<br>
                    <strong>Type:</strong> Marina Berth
                </div>
                <div class="access-details">
                    <strong>Access Details:</strong>
                    <ul>
                        <li>üöó Parking: Marina visitor parking</li>
                        <li>üîë PIN code access at gate</li>
                        <li>üìç 83 Parriwi Rd, Mosman NSW 2088</li>
                        <li>‚ö†Ô∏è Remember to lock gate after entry</li>
                    </ul>
                </div>
                <button class="directions-btn" onclick="getDirections(-33.804169, 151.246879)">
                    <i class="fas fa-route"></i> Get Directions
                </button>
            </div>
        </div>
        
        <div class="map-container">
            <div id="map">
                <div class="api-key-notice">
                    <h3><i class="fas fa-key"></i> Google Maps API Key Required</h3>
                    <p>To enable the interactive map, please add your Google Maps API key:</p>
                    <ol style="text-align: left; max-width: 500px; margin: 1rem auto;">
                        <li>Get an API key from <a href="https://console.cloud.google.com/google/maps-apis/" target="_blank">Google Cloud Console</a></li>
                        <li>Enable the Maps JavaScript API</li>
                        <li>Replace <code>YOUR_API_KEY</code> at the bottom of this HTML file</li>
                    </ol>
                    <p><strong>Alternative:</strong> Use the "Get Directions" buttons for Google Maps navigation</p>
                </div>
            </div>
            
            <div class="view-toggle">
                <button class="toggle-btn active" onclick="showVesselView()">
                    <i class="fas fa-ship"></i> Vessel Locations
                </button>
                <button class="toggle-btn" onclick="showAnchorageView()">
                    <i class="fas fa-anchor"></i> Safe Anchorages
                </button>
            </div>
            
            <div class="legend vessel-legend">
                <h4>Location Types</h4>
                <div class="legend-item">
                    <div class="legend-icon swing-mooring">
                        <i class="fas fa-anchor"></i>
                    </div>
                    <span>Swing Mooring</span>
                </div>
                <div class="legend-item">
                    <div class="legend-icon marina-berth">
                        <i class="fas fa-building"></i>
                    </div>
                    <span>Marina Berth</span>
                </div>
                <div class="legend-item">
                    <div class="legend-icon temp-mooring">
                        <i class="fas fa-clock"></i>
                    </div>
                    <span>Temporary Mooring</span>
                </div>
            </div>
            
            <div class="legend anchorage-legend">
                <h4>Safe Anchorages</h4>
                <p style="font-size: 0.9rem; margin-bottom: 0.5rem;">Protected from S/SE winds</p>
                <ul style="list-style: none; padding: 0;">
                    <li style="margin: 0.3rem 0;"><i class="fas fa-circle" style="color: #E74C3C; opacity: 0.6;"></i> Forty Baskets Beach</li>
                    <li style="margin: 0.3rem 0;"><i class="fas fa-circle" style="color: #E74C3C; opacity: 0.6;"></i> Collins Beach</li>
                    <li style="margin: 0.3rem 0;"><i class="fas fa-circle" style="color: #E74C3C; opacity: 0.6;"></i> Store Beach</li>
                    <li style="margin: 0.3rem 0;"><i class="fas fa-circle" style="color: #E74C3C; opacity: 0.6;"></i> Quarantine Beach</li>
                </ul>
                <div class="alert" style="background: #FEF9E7; border-left: 3px solid #F39C12; padding: 0.5rem; margin-top: 0.5rem; font-size: 0.85rem;">
                    <i class="fas fa-exclamation-triangle" style="color: #D68910;"></i> Use when wind exceeds 20kts from S/SE
                </div>
            </div>
        </div>
    </div>
    
    <script>
        // Initialize Supabase
        const SUPABASE_URL = 'https://etkugeooigiwahikrmzr.supabase.co';
        const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImV0a3VnZW9vaWdpd2FoaWtybXpyIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTI4MDI0OTcsImV4cCI6MjA2ODM3ODQ5N30.OPIYLsnPNNF7dP3SDCODIurzaa3X_Q3xEhfPO3rLJxU';
        const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

        // Check authentication on page load
        async function checkAuth() {
            const { data: { user } } = await supabase.auth.getUser();
            if (!user) {
                // Redirect to login page if not authenticated
                window.location.href = 'auth.html';
            }
        }

        // Run auth check when page loads
        checkAuth();

        let map;
        let markers = {};
        let infoWindows = {};
        let anchorageCircles = [];
        let currentView = 'vessels'; // 'vessels' or 'anchorages'
        
        // Location data
        const locations = {
            littleManly: {
                position: { lat: -33.807998, lng: 151.286544 },
                title: "Little Manly Point Reserve",
                vessel: "JUNIOR (12 seater)",
                mooring: "CL8335 (Red Buoy)",
                type: "swing",
                icon: "anchor",
                content: `
                    <div class="info-window">
                        <h3>Little Manly Point Reserve</h3>
                        <div class="vessel-name">JUNIOR - 12 seater</div>
                        <div class="detail"><strong>Mooring:</strong> CL8335 (Red Buoy)</div>
                        <div class="detail"><strong>Parking:</strong> Stuart Street</div>
                        <div class="detail"><strong>Tender:</strong> Paddle board in racks</div>
                    </div>
                `
            },
            balmoral: {
                position: { lat: -33.826154, lng: 151.254493 },
                title: "Balmoral Beach",
                vessel: "SANDSTONE (8 seater)",
                mooring: "Swing Mooring",
                type: "temp",
                icon: "clock",
                content: `
                    <div class="info-window">
                        <h3>Balmoral Beach</h3>
                        <div class="vessel-name">SANDSTONE - 8 seater</div>
                        <div class="detail"><strong>Type:</strong> Temporary Swing Mooring</div>
                        <div class="detail"><strong>Parking:</strong> The Esplanade</div>
                        <div class="detail"><strong>Note:</strong> Check current status</div>
                    </div>
                `
            },
            seaforth: {
                position: { lat: -33.804468, lng: 151.239951 },
                title: "Seaforth (via The Spit)",
                vessel: "PUMICESTONE (12 seater)",
                mooring: "CA017/CA023",
                type: "swing",
                icon: "anchor",
                content: `
                    <div class="info-window">
                        <h3>Seaforth Mooring Field</h3>
                        <div class="vessel-name">PUMICESTONE - 12 seater</div>
                        <div class="detail"><strong>Mooring:</strong> CA017/CA023</div>
                        <div class="detail"><strong>Access:</strong> Via The Spit</div>
                        <div class="detail"><strong>Tender:</strong> Work Boat near Plonk Cafe</div>
                        <div class="detail"><strong>Note:</strong> Navigate through Spit Bridge</div>
                    </div>
                `
            },
            dalbora: {
                position: { lat: -33.804802, lng: 151.245358 },
                title: "d'Albora Marina - The Spit",
                vessel: "Ice Cream Boat",
                berth: "AE25",
                type: "marina",
                icon: "building",
                content: `
                    <div class="info-window">
                        <h3>d'Albora Marina</h3>
                        <div class="vessel-name">Ice Cream Boat</div>
                        <div class="detail"><strong>Berth:</strong> AE25 (Eastern side)</div>
                        <div class="detail"><strong>Access:</strong> FOB key after 5PM</div>
                        <div class="detail"><strong>Parking:</strong> Marina visitor parking</div>
                        <div class="detail"><strong>Important:</strong> Check shore power</div>
                    </div>
                `
            },
            fergusons: {
                position: { lat: -33.804169, lng: 151.246879 },
                title: "Fergusons Marina",
                vessel: "Work Boat",
                type: "marina",
                icon: "building",
                content: `
                    <div class="info-window">
                        <h3>Fergusons Marina</h3>
                        <div class="vessel-name">Work Boat</div>
                        <div class="detail"><strong>Address:</strong> 83 Parriwi Rd, Mosman</div>
                        <div class="detail"><strong>Access:</strong> PIN code at gate</div>
                        <div class="detail"><strong>Parking:</strong> Marina visitor parking</div>
                        <div class="detail"><strong>Important:</strong> Lock gate after entry</div>
                    </div>
                `
            }
        };
        
        // Safe anchorage data
        const anchorages = [
            {
                name: "Forty Baskets Beach",
                position: { lat: -33.803671, lng: 151.270431 },
                radius: 50, // 50 meter radius for visibility (10x10m might be too small to see)
                description: "Protected anchorage suitable for S/SE winds. Popular spot with good holding."
            },
            {
                name: "Collins Beach",
                position: { lat: -33.808391, lng: 151.290998 },
                radius: 50,
                description: "Well-protected from southerly winds. Good holding in sand."
            },
            {
                name: "Store Beach",
                position: { lat: -33.812269, lng: 151.288648 },
                radius: 50,
                description: "Excellent protection from S/SE winds. Popular anchorage with facilities nearby."
            },
            {
                name: "Quarantine Beach",
                position: { lat: -33.814993, lng: 151.286208 },
                radius: 50,
                description: "Historic location with good protection. Suitable for overnight anchoring in southerlies."
            }
        ];
        
        function initMap() {
            // Create map centered on Sydney Harbour
            map = new google.maps.Map(document.getElementById('map'), {
                center: { lat: -33.810856, lng: 151.256586 },
                zoom: 13,
                mapTypeId: 'hybrid',
                mapTypeControl: true,
                mapTypeControlOptions: {
                    style: google.maps.MapTypeControlStyle.HORIZONTAL_BAR,
                    position: google.maps.ControlPosition.TOP_LEFT
                },
                streetViewControl: true,
                fullscreenControl: true
            });
            
            // Create markers for each location
            Object.keys(locations).forEach(key => {
                const location = locations[key];
                
                // Determine marker color based on type
                let markerColor;
                switch(location.type) {
                    case 'swing':
                        markerColor = '3498DB'; // Blue
                        break;
                    case 'marina':
                        markerColor = '27AE60'; // Green
                        break;
                    case 'temp':
                        markerColor = 'F39C12'; // Orange
                        break;
                    default:
                        markerColor = 'E74C3C'; // Red
                }
                
                // Create custom marker icon
                const marker = new google.maps.Marker({
                    position: location.position,
                    map: map,
                    title: location.title,
                    icon: {
                        url: `https://maps.google.com/mapfiles/ms/icons/${markerColor === '27AE60' ? 'green' : markerColor === 'F39C12' ? 'orange' : 'blue'}-dot.png`,
                        scaledSize: new google.maps.Size(40, 40)
                    },
                    animation: google.maps.Animation.DROP
                });
                
                // Create info window
                const infoWindow = new google.maps.InfoWindow({
                    content: location.content
                });
                
                // Add click listener
                marker.addListener('click', () => {
                    // Close all other info windows
                    Object.values(infoWindows).forEach(iw => iw.close());
                    infoWindow.open(map, marker);
                    
                    // Update active card
                    document.querySelectorAll('.location-card').forEach(card => {
                        card.classList.remove('active');
                    });
                    document.querySelectorAll('.location-card')[Object.keys(locations).indexOf(key)].classList.add('active');
                });
                
                markers[key] = marker;
                infoWindows[key] = infoWindow;
            });
            
            // Add custom controls
            const centerButton = document.createElement('button');
            centerButton.textContent = 'Show All Locations';
            centerButton.style.cssText = `
                background: white;
                border: none;
                padding: 8px 16px;
                margin: 10px;
                border-radius: 5px;
                box-shadow: 0 2px 6px rgba(0,0,0,0.3);
                cursor: pointer;
                font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            `;
            centerButton.addEventListener('click', showAllLocations);
            map.controls[google.maps.ControlPosition.TOP_CENTER].push(centerButton);
            
            // Create anchorage circles (hidden by default)
            createAnchorageCircles();
        }
        
        function focusLocation(locationKey) {
            // Check if map is loaded
            if (typeof google === 'undefined' || !map) {
                alert('Map is not loaded. Please add Google Maps API key or use the "Get Directions" button.');
                return;
            }
            
            const location = locations[locationKey];
            const marker = markers[locationKey];
            const infoWindow = infoWindows[locationKey];
            
            // Close all info windows
            Object.values(infoWindows).forEach(iw => iw.close());
            
            // Pan and zoom to location
            map.panTo(location.position);
            map.setZoom(16);
            
            // Open info window
            infoWindow.open(map, marker);
            
            // Bounce marker
            marker.setAnimation(google.maps.Animation.BOUNCE);
            setTimeout(() => {
                marker.setAnimation(null);
            }, 1500);
            
            // Update active card
            document.querySelectorAll('.location-card').forEach(card => {
                card.classList.remove('active');
            });
            event.currentTarget.classList.add('active');
        }
        

        
        function getDirections(lat, lng) {
            // Open Google Maps with directions
            const url = `https://www.google.com/maps/dir/?api=1&destination=${lat},${lng}`;
            window.open(url, '_blank');
            event.stopPropagation();
        }
        
        // Create anchorage circles
        function createAnchorageCircles() {
            anchorages.forEach(anchorage => {
                const circle = new google.maps.Circle({
                    strokeColor: '#E74C3C',
                    strokeOpacity: 0.8,
                    strokeWeight: 2,
                    fillColor: '#E74C3C',
                    fillOpacity: 0.35,
                    map: null, // Hidden by default
                    center: anchorage.position,
                    radius: anchorage.radius,
                    clickable: true
                });
                
                const infoWindow = new google.maps.InfoWindow({
                    content: `
                        <div class="info-window">
                            <h3>${anchorage.name}</h3>
                            <p style="margin: 0.5rem 0;">${anchorage.description}</p>
                            <div class="detail"><strong>Protection:</strong> S/SE winds</div>
                            <div class="detail"><strong>Max Wind:</strong> 20+ knots</div>
                        </div>
                    `
                });
                
                circle.addListener('click', () => {
                    infoWindow.setPosition(anchorage.position);
                    infoWindow.open(map);
                });
                
                anchorageCircles.push({ circle, infoWindow });
            });
        }
        
        // Show vessel view
        function showVesselView() {
            currentView = 'vessels';
            
            // Update toggle buttons
            document.querySelectorAll('.toggle-btn').forEach(btn => btn.classList.remove('active'));
            event.target.closest('.toggle-btn').classList.add('active');
            
            // Show vessel markers
            Object.values(markers).forEach(marker => marker.setMap(map));
            
            // Hide anchorage circles
            anchorageCircles.forEach(item => {
                item.circle.setMap(null);
                item.infoWindow.close();
            });
            
            // Update legends
            document.querySelector('.vessel-legend').classList.remove('hidden');
            document.querySelector('.anchorage-legend').classList.remove('active');
            
            // Show sidebar
            document.querySelector('.sidebar').style.display = 'block';
            
            // Reset view to show all vessels
            showAllLocations();
        }
        
        // Show anchorage view
        function showAnchorageView() {
            currentView = 'anchorages';
            
            // Update toggle buttons
            document.querySelectorAll('.toggle-btn').forEach(btn => btn.classList.remove('active'));
            event.target.closest('.toggle-btn').classList.add('active');
            
            // Hide vessel markers
            Object.values(markers).forEach(marker => marker.setMap(null));
            Object.values(infoWindows).forEach(iw => iw.close());
            
            // Show anchorage circles
            anchorageCircles.forEach(item => item.circle.setMap(map));
            
            // Update legends
            document.querySelector('.vessel-legend').classList.add('hidden');
            document.querySelector('.anchorage-legend').classList.add('active');
            
            // Hide sidebar
            document.querySelector('.sidebar').style.display = 'none';
            
            // Fit map to show all anchorages
            const bounds = new google.maps.LatLngBounds();
            anchorages.forEach(anchorage => {
                bounds.extend(anchorage.position);
            });
            map.fitBounds(bounds);
        }
        
        // Modified showAllLocations to respect current view
        function showAllLocations() {
            if (currentView === 'vessels') {
                // Create bounds to include all markers
                const bounds = new google.maps.LatLngBounds();
                Object.values(markers).forEach(marker => {
                    bounds.extend(marker.getPosition());
                });
                map.fitBounds(bounds);
                
                // Close all info windows
                Object.values(infoWindows).forEach(iw => iw.close());
                
                // Remove active class from all cards
                document.querySelectorAll('.location-card').forEach(card => {
                    card.classList.remove('active');
                });
            } else {
                // Show all anchorages
                const bounds = new google.maps.LatLngBounds();
                anchorages.forEach(anchorage => {
                    bounds.extend(anchorage.position);
                });
                map.fitBounds(bounds);
            }
        }
        
        // Initialize map when page loads
        window.onload = function() {
            // Show all locations by default after map loads
            if (typeof google !== 'undefined' && map) {
                setTimeout(showAllLocations, 1000);
            }
        };
    </script>
    
    <!-- Google Maps JavaScript API -->
    <!-- IMPORTANT: Replace YOUR_API_KEY with your actual Google Maps API key -->
    <script async defer
        src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBbjgKhMV5I1nwWa8pCf7m-_7G1dz8EDbw&callback=initMap&libraries=&v=weekly">
    </script>
</body>
</html> 